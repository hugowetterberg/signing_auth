(function(){var a=function(b,c){return function(){return b.apply(c,arguments)}};(function(){var b,c;b={};if(true){(function(){var e=b,f=e.util={rotl:function(g,h){return g<<h|g>>>32-h},rotr:function(g,h){return g<<32-h|g>>>h},endian:function(g){if(g.constructor==Number){return f.rotl(g,8)&16711935|f.rotl(g,24)&4278255360}for(var h=0;h<g.length;h++){g[h]=f.endian(g[h])}return g},randomBytes:function(g){for(var h=[];g>0;g--){h.push(Math.floor(Math.random()*256))}return h},bytesToWords:function(h){for(var j=[],g=0,i=0;g<h.length;g++,i+=8){j[i>>>5]|=h[g]<<24-i%32}return j},wordsToBytes:function(h){for(var i=[],g=0;g<h.length*32;g+=8){i.push(h[g>>>5]>>>24-g%32&255)}return i},bytesToHex:function(h){for(var i=[],g=0;g<h.length;g++){i.push((h[g]>>>4).toString(16));i.push((h[g]&15).toString(16))}return i.join("")},hexToBytes:function(h){for(var i=[],g=0;g<h.length;g+=2){i.push(parseInt(h.substr(g,2),16))}return i},bytesToBase64:function(h){if(typeof btoa=="function"){return btoa(d.bytesToString(h))}for(var k=[],g=0;g<h.length;g+=3){for(var j=h[g]<<16|h[g+1]<<8|h[g+2],i=0;i<4;i++){g*8+i*6<=h.length*8?k.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(j>>>6*(3-i)&63)):k.push("=")}}return k.join("")},base64ToBytes:function(h){if(typeof atob=="function"){return d.stringToBytes(atob(h))}h=h.replace(/[^A-Z0-9+\/]/ig,"");for(var j=[],g=0,i=0;g<h.length;i=++g%4){i!=0&&j.push(("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(h.charAt(g-1))&Math.pow(2,-2*i+8)-1)<<i*2|"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(h.charAt(g))>>>6-i*2)}return j}};e=e.charenc={};e.UTF8={stringToBytes:function(g){return d.stringToBytes(unescape(encodeURIComponent(g)))},bytesToString:function(g){return decodeURIComponent(escape(d.bytesToString(g)))}};var d=e.Binary={stringToBytes:function(h){for(var i=[],g=0;g<h.length;g++){i.push(h.charCodeAt(g)&255)}return i},bytesToString:function(h){for(var i=[],g=0;g<h.length;g++){i.push(String.fromCharCode(h[g]))}return i.join("")}}})()}(function(){var g=b,k=g.util,f=g.charenc,e=f.UTF8,h=f.Binary,d=g.SHA1=function(l,j){var i=k.wordsToBytes(d._sha1(l));return j&&j.asBytes?i:j&&j.asString?h.bytesToString(i):k.bytesToHex(i)};d._sha1=function(D){if(D.constructor==String){D=e.stringToBytes(D)}var C=k.bytesToWords(D),B=D.length*8;D=[];var y=1732584193,A=-271733879,x=-1732584194,w=271733878,v=-1009589776;C[B>>5]|=128<<24-B%32;C[(B+64>>>9<<4)+15]=B;for(B=0;B<C.length;B+=16){for(var j=y,i=A,G=x,F=w,E=v,z=0;z<80;z++){if(z<16){D[z]=C[B+z]}else{var n=D[z-3]^D[z-8]^D[z-14]^D[z-16];D[z]=n<<1|n>>>31}n=(y<<5|y>>>27)+v+(D[z]>>>0)+(z<20?(A&x|~A&w)+1518500249:z<40?(A^x^w)+1859775393:z<60?(A&x|A&w|x&w)-1894007588:(A^x^w)-899497514);v=w;w=x;x=A<<30|A>>>2;A=y;y=n}y+=j;A+=i;x+=G;w+=F;v+=E}return[y,A,x,w,v]};d._blocksize=16;d._digestsize=20})();(function(){var f=b,h=f.util,e=f.charenc,d=e.UTF8,g=e.Binary;f.HMAC=function(i,o,n,m){if(o.constructor==String){o=d.stringToBytes(o)}if(n.constructor==String){n=d.stringToBytes(n)}if(n.length>i._blocksize*4){n=i(n,{asBytes:true})}var j=n.slice(0);n=n.slice(0);for(var l=0;l<i._blocksize*4;l++){j[l]^=92;n[l]^=54}i=i(j.concat(i(n.concat(o),{asBytes:true})),{asBytes:true});return m&&m.asBytes?i:m&&m.asString?g.bytesToString(i):h.bytesToHex(i)}})();window.SigningAuth=c=(function(){d.prototype.handlers={};d.prototype.challenge=null;d.prototype.automaticResponse=false;d.prototype.automaticResponseFailed=false;d.prototype.bind=function(f,e){if(!(this.handlers[f]!=null)){this.handlers[f]=[]}return this.handlers[f].push(e)};d.prototype.unbind=function(g,f){var e;if(f==null){f=false}if(this.handlers[g]!=null){if(f){return delete this.handlers[g]}else{e=this.handlers.indexOf(f);return delete this.handlers[e]}}};d.prototype.trigger=function(i){var g,h,k,f,j,e;if(this.handlers[i]!=null){g=Array.prototype.slice.call(arguments,1);j=this.handlers[i];e=[];for(k=0,f=j.length;k<f;k++){h=j[k];e.push(h.apply(this,g))}return e}};function d(f,h,g,e){this.socket=f;this.storage=h!=null?h:false;this.key=g!=null?g:false;this.secret=e!=null?e:false;this.socket.on("challenge-failed",a(function(i){console.log("Challenge failed "+i.message);if(this.storage){delete this.storage.signature_key;delete this.storage.signature_secret}this.trigger("failed",i,this.automaticResponse);if(this.automaticResponse){this.automaticResponseFailed=true}return this.automaticResponse=false},this));this.socket.on("challenge-success",a(function(i){console.log("Challenge success");return this.trigger("success",i)},this));this.socket.on("challenge",a(function(i){this.challenge=i.sign;console.log("Got challenge asking us to sign "+i.sign);if(!this.automaticResponseFailed&&this.storage&&(this.storage.signature_key!=null)&&(this.storage.signature_secret!=null)){console.log("Trying an automatic response");this.automaticResponse=true;return this.response(this.storage.signature_key,this.storage.signature_secret)}else{console.log("Triggering a challenge event");this.automaticResponse=false;return this.trigger("challenge",i,false)}},this))}d.prototype.clearCredentials=function(){if(this.storage){delete this.storage.signature_key;return delete this.storage.signature_secret}};d.prototype.response=function(g,f){var e;if(this.storage){this.storage.signature_key=g;this.storage.signature_secret=f}this.trigger("responding",this.automaticResponse);console.log("Signing "+g+this.challenge+" with "+f);e=b.HMAC(b.SHA1,g+this.challenge,f);return socket.emit("challenge-response",{key:g,signature:e})};return d})();return null})()}).call(this);